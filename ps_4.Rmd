---
title: "Problem Set 4"
author: "Jeff Huang"
date: "2/26/2019"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(gt)

elec_resp <- read_csv(file = "ps_4_elections-poll-nc09-3.csv",
                      col_types =  cols(
                        .default = col_character(),
                        final_weight = col_double(),
                        timestamp=col_datetime(format="%m/%d/%y %H:%M")))

# Question 1.2 
rep_fav_count <- elec_resp %>% 
  filter(hrep_fav =="Favorable") %>%
  count()

und_count <- elec_resp %>%
  filter(response =="Und") %>% 
  count()

# Question 1.4
elec_resp %>% filter(response=="Dem") %>% count()

# Question 1.5
first_rep <- elec_resp %>% 
  filter(response=="Rep") %>% 
  arrange(timestamp) %>% 
  head(1)
  
  
first_dem <- elec_resp %>% 
  filter(response=="Dem") %>% 
  arrange(timestamp) %>% 
  head(1) 


```

## Question 1
There were `r elec_resp %>% filter(response=="Dem") %>% count()` respondents who supported the Democratic candidate.

There were `r rep_fav_count - und_count` more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables (gender and gender_combined). There are `r elec_resp %>% filter(gender!=gender_combined) %>% count()` individuals for whom these variables have different values.

There are `r elec_resp %>% filter(race_eth == "White") %>% filter(file_race_black != "White") %>% count()` respondents listed as “White” under race_eth who are not listed as “White” under file_race_black.

The first response of Rep came `r minute(first_rep$timestamp) - minute(first_dem$timestamp)` minutes (rounded to the nearest minute) before the first response of Dem.

## Question 2
```{r question_2, echo=FALSE}
elec_resp %>% 
  select(response,race_eth,final_weight) %>% 
  filter(!race_eth %in% "[DO NOT READ] Don't know/Refused") %>% 
  mutate(race_eth=fct_relevel(race_eth, "White", "Black", "Hispanic", "Asian", "Other")) %>% 
  group_by(race_eth, response) %>% 
  summarize(total=sum(final_weight)) %>% 
  spread(key=response, value=total, fill=0) %>% 
  mutate(all=Dem+Rep+Und+3) %>% 
  mutate(Dem=Dem/all) %>%
  mutate(Rep=Rep/all) %>%
  mutate(Und=Und/all) %>% 
  select(-all, -"3") %>% 
  
  ungroup() %>% 
  
  gt() %>% 
    tab_header(
      title= "Polling Results in North Carolina's 9th Congressional District (2018)",
      subtitle="Party voting by race") %>% 
    tab_source_note("Source: The Upshot Live Poll Results (2018)") %>% 
      
    
    cols_label(
      race_eth = "Race",
      Dem = "DEM.",
      Rep = "REP.",
      Und = "UND."
      ) %>%
  
    fmt_percent(columns = vars(Dem, Rep, Und),
                decimals = 0) 
```

## Question 3
```{r question_3, echo=FALSE, fig.width = 7.2}
elec_resp %>% 
  select(educ,final_weight) %>% 
  filter(! educ %in% "[DO NOT READ] Refused") %>% 
  mutate(educ=fct_rev(factor(educ, levels=c("Graduate or Professional Degree", "Bachelors' degree", "Some college or trade school", "High school", "Grade school")))) %>% 
  group_by(educ) %>% 
  
  
  ggplot(aes(x=educ,y=final_weight))+
  geom_violin(width=0.2) +
  geom_jitter(aes(alpha=0.05),position=position_jitter(0.2), show.legend = FALSE) +
  coord_flip() +
  xlab(NULL) +
  ylab("Weight Given to Respondent in Calculating Poll Results") + 
  labs(title = "More Educated Matter Less in North Carolina 9th Congressional District",
       subtitle = "Poll gives more weight to people who are less likely to participate in polls",
       caption="New York Times Upshot/Siena College 2018 live polls")
```

## Question 4

```{r question_4, echo=FALSE}
elec_resp %>% 
  



```

